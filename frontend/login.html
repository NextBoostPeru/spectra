<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login | Spectra</title>
  <script>
    window.tailwind = window.tailwind || {};
    window.tailwind.config = { theme: { extend: { colors: { brand: '#006d71' } } } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body class="min-h-screen bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    const DEFAULT_API_URL = 'http://localhost:8000/api/login';

    function LoginForm() {
      const [apiUrl, setApiUrl] = useState(DEFAULT_API_URL);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [status, setStatus] = useState({ type: 'idle', message: '', token: null, user: null });

      const submit = async (event) => {
        event.preventDefault();
        setStatus({ type: 'loading', message: 'Conectando…', token: null, user: null });

        try {
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
          });

          const payload = await response.json();
          if (!response.ok) {
            throw new Error(payload.error || 'No se pudo iniciar sesión');
          }

          setStatus({ type: 'success', message: payload.message, token: payload.token, user: payload.user });
        } catch (error) {
          setStatus({ type: 'error', message: error.message, token: null, user: null });
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-brand/10 via-white to-brand/5 flex items-center justify-center px-4 py-8">
          <div className="w-full max-w-lg bg-white shadow-xl rounded-2xl overflow-hidden">
            <div className="bg-brand text-white px-6 py-5">
              <p className="text-xs uppercase tracking-[0.25em] font-semibold text-white/80">Spectra</p>
              <h1 className="text-2xl font-bold">Accede a tu cuenta</h1>
              <p className="text-sm text-white/80">Frontend y backend están separados; apunta la URL al servidor PHP.</p>
            </div>

            <div className="p-6 space-y-6">
              <form className="space-y-4" onSubmit={submit}>
                <div className="space-y-2">
                  <label className="block text-sm font-medium text-slate-700" htmlFor="apiUrl">URL de la API</label>
                  <input
                    id="apiUrl"
                    type="url"
                    value={apiUrl}
                    onChange={(e) => setApiUrl(e.target.value)}
                    required
                    className="w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                    placeholder={DEFAULT_API_URL}
                  />
                </div>

                <div className="space-y-2">
                  <label className="block text-sm font-medium text-slate-700" htmlFor="email">Correo electrónico</label>
                  <input
                    id="email"
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    required
                    className="w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                    placeholder="usuario@dominio.com"
                  />
                </div>

                <div className="space-y-2">
                  <label className="block text-sm font-medium text-slate-700" htmlFor="password">Contraseña</label>
                  <input
                    id="password"
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    required
                    className="w-full rounded-lg border border-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand"
                    placeholder="••••••••"
                  />
                </div>

                <button
                  type="submit"
                  disabled={status.type === 'loading'}
                  className="w-full flex items-center justify-center gap-2 rounded-lg bg-brand text-white font-semibold py-3 hover:bg-brand/90 transition focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand disabled:opacity-60"
                >
                  {status.type === 'loading' ? 'Validando...' : 'Ingresar'}
                </button>
              </form>

              {status.type !== 'idle' && (
                <div
                  className={`rounded-lg border p-4 text-sm ${
                    status.type === 'success'
                      ? 'border-brand/30 bg-brand/5 text-brand'
                      : status.type === 'error'
                        ? 'border-red-200 bg-red-50 text-red-800'
                        : 'border-slate-200 bg-slate-50 text-slate-700'
                  }`}
                >
                  <p className="font-semibold">{status.message}</p>
                  {status.user && (
                    <div className="mt-2 space-y-1 text-xs text-slate-700">
                      <p><span className="font-medium">Usuario:</span> {status.user.full_name} ({status.user.email})</p>
                      <p><span className="font-medium">Rol:</span> {status.user.platform_role}</p>
                      <p><span className="font-medium">Token:</span> {status.token}</p>
                    </div>
                  )}
                </div>
              )}

              <div className="text-xs text-slate-500 space-y-1">
                <p>Backend PHP: <code className="font-mono">php -S localhost:8000 -t public</code></p>
                <p>Recuerda habilitar CORS si sirves el frontend desde otro origen.</p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LoginForm />);
  </script>
</body>
</html>
